<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="beta.function.account.dao.AccountMapper">

    <resultMap id="authenticatedUser" type="beta.function.account.dto.AccountDTO">
        <id property="userCode" column="userCode"/>
        <result property="username" column="username"/>
        <result property="password" column="password"/>
        <result property="fullName" column="fullName"/>
        <result property="userRole" column="authorityCodeName"/>
        <result property="email"    column="email"/>
    </resultMap>

    <select id="findByUsername" resultMap="authenticatedUser">
        SELECT
            a.userCode,
            a.username,
            a.password,
            b.authorityCodeName
        FROM
            account_list a
        join
            account_authority b  on a.authorityCode = b.authorityCode
        WHERE
            a.username = #{ username }
    </select>

    <insert id="regist" parameterType="beta.function.account.dto.SignupDTO" >
    INSERT INTO account_list
    (
        userName,
        password,
        fullName,
        nickName,
        birthday,
        email,
        phone,
        profileimg,
        authorityCode
    )
    VALUES
    (
        #{ username },
        #{ password },
        #{ fullName },
        #{ nickName },
        #{ birthday },
        #{ email },
        #{ phone },
        #{ profileimg },
        (
            SELECT
                authorityCode
            FROM
                account_authority
            WHERE
                authoritycodename = 'USER'
        )
    )
    </insert>

    <select id="lostId" resultMap="authenticatedUser">
        SELECT
        a.username
        FROM
        account_list a
        WHERE
        a.email = #{ email }
    </select>

    <update id="changepwd" parameterType="beta.function.account.dto.AccountDTO">
        update
        account_list
        set password = #{ password }
        where username = #{ username };
    </update>

</mapper>